//   - This file is part of ChessHelper Extension
//  <https://github.com/gerwld/ChessHelper-extension/blob/main/README.md>,
//   - Copyright (C) 2023-present ChessHelper Extension
//   -
//   - ChessHelper Extension is a software: you can redistribute it, but you are not allowed to modify it under the terms of the Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0) License.
//   -
//   - ChessHelper Extension is distributed in the hope that it will be useful,
//   - but WITHOUT ANY WARRANTY; without even the implied warranty of
//   - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//   - Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0) License for more details.
//   -
//   - You should have received a copy of the Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0) License
//   - along with ChessHelper Extension.  If not, see <https://creativecommons.org/licenses/by-nc-nd/4.0/>.
(()=>{"use strict";{let e,o,a,r;const f=["roboto","poppins","caprasimo","playfair","merriweather","noto_sans","nunito","montserrat","pixelify","gabarito","roboto_condensed","inter"],y=["night_owl","purple_dark","kittens","ws_type","srl"],v=["anime","dani_maccari","itchy","itchy2","marble","mom_still_loves_them","kiwen_suwi","pjaworski","cburnett","cburnett_jp","pjaworski_ice","pjaworski_metal","pjaworski_forest","pjaworski_bluelake","pjaworski_bluelake2","pjaworski_purple","pjaworski_pink","new_metropol","ancient_set","32bit_lucas312","letters"],w=["anime","arcade","gray_eyes","peppermint","blackwhite","green2","polarizer","darkblue","purple","disa_board","middaysun","teal","disa_night","overheated_stain","webpunk","glass","paperice","wood"],S=chrome||browser;function s(){(document.getElementById("board")||document.getElementById("board-single"))?.querySelector("canvas")&&location.reload()}function l(t){-1!==y.indexOf(t)&&i(`/assets/graphs/themes/${t}.css`,!0,t),y.filter(e=>e!==t).forEach(e=>document.getElementById(e)?.remove())}function c(t){-1!==f.indexOf(t)&&i(`/assets/graphs/fonts/${t}.css`,!0,t),f.filter(e=>e!==t).forEach(e=>document.getElementById(e)?.remove())}function i(e,a,r){fetch(S.runtime.getURL(e)).then(e=>e.text()).then(e=>{var t=document.getElementById(r),o=document.createElement("style");o.textContent=e,o.setAttribute("id",r),a&&!t?document.head.appendChild(o):!a&&t instanceof Node&&document.head.removeChild(t)}).catch(e=>{})}function d(e,t,o){var a=document.getElementById(o),r=document.createElement("style");r.textContent=e,r.setAttribute("id",o),t&&!a?document.head.appendChild(r):!t&&a instanceof Node&&document.head.removeChild(a)}function u(e){clearInterval(o);var t=window.location.href&&window.location.href.includes("/home")||"https://chess.com"===window.location.href||"https://chess.com/"===window.location.href;e&&t?o=setInterval(function(){var e=document.querySelector(".tv-player-component"),t=document.querySelector(".layout-column-two").querySelectorAll(".v5-section");e&&(e.remove(),t)&&t.length&&t.forEach(e=>{e.querySelector('[href*="/member"].v5-header-name')&&e.remove(),e.querySelector('[href*="/tv"].v5-header-name')&&e.remove()})},200):clearInterval(o)}function m(e){clearInterval(a);var t=window.location.href&&window.location.href.includes("/play/")||window.location.href&&window.location.href.includes("/game/");e&&t?a=setInterval(function(){var e=document.querySelector(".toggle-custom-game-button");document.querySelector('[data-cy="time-selector-category-30"')||"More Time Controls"!=e?.innerText||e.click()},20):e||("Fewer Time Controls"==(t=document.querySelector(".toggle-custom-game-button"))?.innerText&&t.click(),clearInterval(a))}function p(o){var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=o?"coordinates_inj coordinates_inj__flipped":"coordinates_inj coordinates_inj__normal";e.setAttribute("version","1.1"),e.setAttribute("class",t),e.setAttribute("viewBox","0 0 100 100");for(let t=0;t<8;t++){var a,r=document.createElementNS("http://www.w3.org/2000/svg","g");t%2!=0&&((a=document.createElement("text")).setAttribute("font-size","0"),a.setAttribute("transform","matrix(1 0 0 1 0 0)"),r.appendChild(a));for(let e=7;0<=e;e--){var n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("transform","matrix(1 0 0 1 "+(8.1+12.4*t)+" "+(11.5+12.4*e)+")"),n.setAttribute("font-size","3.4px"),n.textContent=o?String.fromCharCode(104-t)+(e+1):String.fromCharCode(97+t)+(8-e),r.appendChild(n)}e.appendChild(r)}return e}function _(e){clearInterval(r);var t=window.location.href&&window.location.href.includes("/play/")||window.location.href&&window.location.href.includes("/game/");e&&t?r=setInterval(async function(){var e,t,o=document.getElementById("board")||document.getElementById("board-single");o&&o.querySelector(".coordinates")&&(o.querySelector(".coordinates").style.opacity="0"),o?.querySelector(".coordinates_inj")||(e=p(),t=p(!0),o.appendChild(e),o.appendChild(t))},20):e||(clearInterval(r),(t=document.getElementById("board")||document.getElementById("board-single"))?.querySelector(".coordinates")&&(t.querySelector(".coordinates").style.display="block",t.querySelector(".coordinates").style.opacity="1",t.querySelectorAll(".coordinates_inj").forEach(e=>e.remove())))}function h(e){if(e){let t=!1;e=document.createElement("div");function o(){document.exitFullscreen&&document.fullscreenElement?document?.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}e.innerHTML='<button class="fullscreen_pgl">Enter Full Screen</button><style>.fullscreen_pgl {position: fixed;bottom: 10px;right: 10px;z-index: 10;}</style>',e.addEventListener("click",function(){var e=document.querySelector(".fullscreen_pgl");t?(e.innerHTML="Enter Full Screen",o()):(e.innerHTML="Exit Full Screen",(e=document.documentElement).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()),t=!t},!1),document.querySelector(".fullscreen_pgl")||document.querySelector("body").appendChild(e),document.addEventListener("fullscreenchange",function(){var e=document.querySelector(".fullscreen_pgl");!document.fullscreenElement&&t&&(e.innerHTML="Enter Full Screen",o(document.documentElement),t=!1)},!1)}else document.querySelectorAll(".fullscreen_pgl")?.forEach(e=>e.remove())}function g(o,a){function r(){location.reload()}clearInterval(e),o||a?e=setInterval(function(){document.querySelectorAll(".alerts-alert").forEach(e=>{var t;e.innerText.includes("refresh the page")&&(o||a)&&!e.querySelector(".reload_pgdl")&&(console.log("[ChessHelper]: Founded reload popup. Adding button."),(t=document.createElement("div")).innerHTML='<button class="reload_pgdl">Click to Reload</button><style>.reload_pgdl {order: 1} .alerts-info {display: flex; align-items: center} .alerts-close {order: 2}</style>',t.addEventListener("click",r,!1),e.appendChild(t))})},200):(document.querySelector(".reload_pgdl")?.remove(),clearInterval(e))}S.storage.local.get("formState",e=>{e=e.formState.disabled?{show_aside:!0}:e.formState;l(e.theme),c(e.font)}),S.storage.local.onChanged.addListener((e,t)=>{e.formState&&e.formState.newValue&&e.formState.oldValue&&JSON.stringify({...e.formState.newValue})!==JSON.stringify({...e.formState.oldValue})&&b({...e.formState.oldValue})});let n=!1;function b(o){S.storage.local.get("formState",async e=>{var t=e.formState.disabled?{show_aside:!0}:e.formState;l(t.theme),c(t.font),async function(t,e,o){var a=JSON.parse(localStorage.getItem("boardOptionsCache"));o||"arcade"===a?.animationType||"natural"===a?.animationType||await new Promise(e=>setTimeout(e,200)),t!==e&&o&&(s(),d("#board-single, #board {opacity: 0!important; transition: opacity 0ms linear 0ms!important}",!0,"board_l3_appear"),setTimeout(()=>{document.getElementById("board_l3_appear")?.remove()},100)),-1!==v.indexOf(t)&&i(`/assets/graphs/pieces/${t}.css`,!0,t),v.filter(e=>e!==t).forEach(e=>document.getElementById(e)?.remove())}(t.pieces,o.pieces,n),async function(t,e,o){var a=JSON.parse(localStorage.getItem("boardOptionsCache"));o||"arcade"===a.animationType||"natural"===a.animationType||await new Promise(e=>setTimeout(e,200)),t!==e&&o&&(s(),d("#board-single, #board {opacity: 0!important; transition: opacity 0ms linear 0ms!important}",!0,"board_l3_appear"),setTimeout(()=>{document.getElementById("board_l3_appear")?.remove()},100)),-1!==w.indexOf(t)&&i(`/assets/graphs/boards/${t}.css`,!0,t),w.filter(e=>e!==t).forEach(e=>document.getElementById(e)?.remove())}(t.board,o.board,n),n||(n=!0,setTimeout(()=>{document.getElementById("board_l3_appear")?.remove()},200)),1==o?.disabled&&0==e?.formState?.disabled&&"boolean"==typeof o?.disabled&&"boolean"==typeof e?.formState?.disabled&&s(),document.body.style.transition="all 0s!important",document.documentElement.style.opacity=1,i("/assets/graphs/coor_each.css",t.coor_each,"coor_each"),i("/assets/graphs/block_images.css",t.block_images,"block_images"),i("/assets/graphs/disable_aboutme.css",t.disable_aboutme,"disable_aboutme"),i("/assets/graphs/board_100vh.css",t.board_100vh,"board_100vh"),i("/assets/graphs/aside_hide.css",!t.show_aside,"aside_hide"),i("/assets/graphs/aside_smaller.css",t.show_aside__smaller,"aside_smaller"),i("/assets/graphs/aside_grayscale.css",t.show_aside__grayscale,"aside_grayscale"),i("/assets/graphs/hide_evaluation.css",t.hide_evaluation,"hide_evaluation"),i("/assets/graphs/add_hyperbullet.css",t.add_hyperbullet,"add_hyperbullet"),i("/assets/graphs/coor_bigger.css",t.coor_bigger,"coor_bigger"),i("/assets/graphs/bigger_controls.css",t.bigger_controls,"bigger_controls"),i("/assets/graphs/disable_cursor.css",t.disable_cursor,"disable_cursor"),i("/assets/graphs/disable_chat.css",t.disable_chat,"disable_chat"),i("/assets/graphs/disable_chat_unless.css",t.disable_chat_unless,"disable_chat_unless"),i("/assets/graphs/reload_disconnect.css",t.reload_disconnect,"reload_disconnect"),i("/assets/graphs/single_resign.css",t.single_resign,"single_resign"),i("/assets/graphs/coor_each__less.css",t.coor_each__less,"coor_each__less"),i("/assets/graphs/focus_mode.css",t.focus_mode,"focus_mode"),_(t.coor_each),u(t.disable_stream),m(t.add_hyperbullet),h(t.add_fullscreen),t.board_100vh&&(document.querySelector(".nav-component").classList.add("collapsed"),document.body.classList.add("nav-collapsed")),g(t.reload_disconnect_1,t.reload_disconnect_2),i("/assets/graphs/square_shaped.css",t.square_shaped,"square_shaped")})}var t;(t=0)&&!isNaN(t)&&(document.body.style.opacity=0,setTimeout(()=>document.body.style.opacity=1,t)),document.addEventListener("DOMContentLoaded",b,!1),document.addEventListener("DOMContentLoaded",function(){d(".coordinates_inj {opacity: 0;} .coordinates_inj__flipped {display: none} #board-single, #board {transition: opacity 200ms ease 50ms}",!0,"BASE_STYLES"),d("#board-single, #board {opacity: 0!important; transition: opacity 0ms linear 0ms!important}",!0,"board_l3_appear")},!1)}})();